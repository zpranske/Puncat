%%%%%% PIPECAT TM %%%%%%
% Zachary Pranske
% Paradis Lab
% Rev. 10/12/2022  

%% Description
% This macro takes as input the automatically generated "Measure" and
% "Summary" files generated by Puncat (originally designed to work with
% Puncat v2.4) and processes them for analysis, combines them into a single
% dataset, and runs basic summary statistics. Further analysis will depend
% on the project type.

%% Combine files
d = dir(uigetdir('C:\Users\Zachary_Pranske\Desktop\pipeline_inputs'));
while(~max(ismember({d(1:end).name},"measure")) || ~max(ismember({d(1:end).name},"summary")))
    disp('ERROR: Folder must be parent folder containing "measure" and "summary" folders')
    d = dir(uigetdir('C:\Users\Zachary_Pranske\Desktop\pipeline_inputs'));
end; 

% %DELETE THIS LINE LATER
%  d = dir('C:\Users\Zachary_Pranske\Desktop\pipeline_inputs');

 disp('Found measure and summary folders...')

 d_measure = d(ismember({d(1:end).name},"measure"));
 d_summary = d(ismember({d(1:end).name},"summary"));
 measure_files = dir([d_measure.folder '\' d_measure.name]);
 summary_files = dir([d_summary.folder '\' d_summary.name]);

 M = processMeasures(measure_files);
 S = processSummary(summary_files);
 disp('File processing done!')
 


%% GRAPHING - Need to format data for import
% b = bar([1 2],[mean(gfpdata(:,5)) mean(sema4ddata(:,5))]);
% b.FaceColor = [.8 .8 .9];
% b.BarWidth = .8;
% hold on
% plotSpread(gfpdata(1:end,5),'BinWidth',.025,'DistributionMarkers','.','xValues',1);
% plotSpread(sema4ddata(1:end,5),'BinWidth',.025,'DistributionMarkers','.','xValues',2);
% e = errorbar([1 2], [mean(gfpdata(:,5)) mean(sema4ddata(:,5))], [std(gfpdata(:,5))/sqrt(length(gfpdata(:,5)))...
%     std(sema4ddata(:,5))/sqrt(length(sema4ddata(:,5)))]);
% e.LineWidth = 1.25;
% e.LineStyle = 'none';
% e.Color = 'r';
% box off
% 
% figure(2)
% b = bar([1 2],[mean(gfpdata(:,6)) mean(sema4ddata(:,6))]);
% b.FaceColor = [.8 .8 .9];
% b.BarWidth = .8;
% hold on
% plotSpread(gfpdata(1:end,6),'BinWidth',.025,'DistributionMarkers','.','xValues',1);
% plotSpread(sema4ddata(1:end,6),'BinWidth',.025,'DistributionMarkers','.','xValues',2);
% e = errorbar([1 2], [mean(gfpdata(:,6)) mean(sema4ddata(:,6))], [std(gfpdata(:,6))/sqrt(length(gfpdata(:,6)))...
%     std(sema4ddata(:,6))/sqrt(length(sema4ddata(:,6)))]);
% e.LineWidth = 1.25;
% e.LineStyle = 'none';
% e.Color = 'r';
% box off